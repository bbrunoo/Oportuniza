<div class="container">
  <div class="conteudo">
    <div class="conteudo-left">
      <div class="image-upload-area" (click)="fileInput.click()" (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" [class.dragging]="isDragging">
        <img *ngIf="previewUrl" [src]="previewUrl" alt="Preview da Imagem da Vaga" class="preview-image" />

        <div class="upload-placeholder" *ngIf="!previewUrl">
          <p>Arraste e solte a imagem aqui</p>
          <p class="upload-subtext">ou clique para selecionar</p>
        </div>
      </div>
      <input hidden type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" />
      <button type="button" class="btn btn-outline-primary mt-3" (click)="fileInput.click()">
        Escolher Imagem üñºÔ∏è
      </button>
    </div>

    <div class="conteudo-right">
      <h2 class="title">Informa√ß√µes da Empresa</h2>
      <form (ngSubmit)="onSubmit()">
        <input type="text" placeholder="Nome da empresa" class="form-control" [(ngModel)]="name" name="name" />
        <input type="text" [value]="selectedCity?.name" placeholder="Selecione a cidade" readonly class="form-control"
          (click)="openCityModal()" />
        <input type="tel" placeholder="Telefone" class="form-control" [(ngModel)]="phone" name="phone"
          mask="00 00000-0000" />
        <input type="email" placeholder="E-mail" class="form-control" [(ngModel)]="email" name="email" />
        <input type="text" placeholder="CNPJ" class="form-control" [(ngModel)]="cnpj" name="cnpj"
          mask="00.000.000/0000-00" />
        <textarea placeholder="Escreva sobre a empresa (m√°x. 300 caracteres)..." class="form-control form-textarea"
          maxlength="300" [(ngModel)]="description" name="description"></textarea>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">Criar Empresa</span>
            <span *ngIf="isLoading">Criando...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="cityModalOpen">
  <div class="modal">
    <h3>Selecione a cidade</h3>

    <input type="text" [formControl]="cityControl" placeholder="Digite para buscar" class="custom-input" />

    <ul *ngIf="filteredCities.length > 0" class="custom-options">
      <li *ngFor="let city of filteredCities" (click)="selectCity(city)" class="custom-option">
        {{ city.name }}
      </li>
    </ul>
    <button class="close-btn" (click)="closeCityModal()">Fechar</button>
  </div>
</div>

<div class="email-verification-overlay" *ngIf="verificationModalOpen">
  <div class="email-verification-modal">
    <h3>Verifica√ß√£o de Empresa</h3>

    <div *ngIf="!codeSent" class="email-step">
      <p>Ser√° enviado um c√≥digo de verifica√ß√£o para o e-mail informado.</p>
      <p><strong>{{ email }}</strong></p>
      <div class="email-actions">
        <button class="email-btn email-btn-cancel" (click)="closeVerificationModal()">Cancelar</button>
        <button class="email-btn email-btn-send" (click)="sendEmailCode()">Enviar C√≥digo</button>
      </div>
    </div>

    <div *ngIf="codeSent" class="verify-card">
      <header class="verify-header">
        <p class="verify-subtitle">
          Enviamos um c√≥digo de {{ codeLength }} d√≠gitos para
          <strong>{{ email }}</strong>.
        </p>
        <p class="verify-subtitle">Digite o c√≥digo abaixo para continuar.</p>
      </header>

      <div class="otp-group">
        <input #d1 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[0]"
          (input)="onInput($event, 0)" (keydown)="onKeydown($event, 0)" />
        <input #d2 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[1]"
          (input)="onInput($event, 1)" (keydown)="onKeydown($event, 1)" />
        <input #d3 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[2]"
          (input)="onInput($event, 2)" (keydown)="onKeydown($event, 2)" />
        <input #d4 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[3]"
          (input)="onInput($event, 3)" (keydown)="onKeydown($event, 3)" />
        <input #d5 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[4]"
          (input)="onInput($event, 4)" (keydown)="onKeydown($event, 4)" />
        <input #d6 class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" [(ngModel)]="codeInputs[5]"
          (input)="onInput($event, 5)" (keydown)="onKeydown($event, 5)" />
      </div>

      <div class="resend-row">
        <span class="muted">N√£o recebeu?</span>
        <button class="btn btn-link" [disabled]="cooldown > 0" (click)="resendCode()">
          {{ cooldown > 0 ? 'Reenviar em ' + cooldown + 's' : 'Reenviar c√≥digo' }}
        </button>
      </div>

      <div class="email-actions">
        <button class="email-btn email-btn-cancel" (click)="closeVerificationModal()">Cancelar</button>
        <button class="email-btn email-btn-confirm" [disabled]="isVerifying" (click)="confirmCompany()">
          {{ isVerifying ? 'Verificando...' : 'Confirmar e Criar Empresa' }}
        </button>
      </div>
    </div>
  </div>
</div>
